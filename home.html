<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>카카오페이 홈</title>
  <meta name="viewport" content="width=400, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#f7f8fa] min-h-screen relative font-sans">

  <!-- 상단 헤더 -->
  <div class="pt-7 px-5 pb-2">
    <div class="flex items-center justify-between">
      <div class="font-bold text-2xl text-[#191919] flex items-center gap-1">
        <span>💬</span>pay
      </div>
      <div class="flex gap-4 items-center">
        <button class="bg-none border-none rounded-full p-1.5 hover:bg-[#f6f8fa] hover:shadow-md hover:text-blue-600 transition"><span class="text-xl">&#128269;</span></button>
        <button class="bg-none border-none rounded-full p-1.5 hover:bg-[#f6f8fa] hover:shadow-md hover:text-blue-600 transition relative">
          <span class="text-xl">&#128276;</span>
          <span class="absolute top-0 right-0 bg-red-500 w-2 h-2 rounded-full"></span>
        </button>
        <button class="bg-none border-none rounded-full p-1.5 hover:bg-[#f6f8fa] hover:shadow-md hover:text-blue-600 transition"><span class="text-xl">&#9776;</span></button>
      </div>
    </div>
  </div>

  <!-- 페이머니 박스 -->
  <div class="bg-white rounded-[18px] mx-3 mt-3 px-5 py-4 shadow flex flex-col gap-2">
    <div class="flex items-center text-[15px] text-gray-400 gap-1">
      <span class="font-medium text-[#6e6e6e]">페이머니</span>
      <span class="mx-1 text-[7px]">•</span>
      <span class="text-[#b2b2b2]">pay</span>
      <span class="mx-1 text-[7px]">•</span>
      <span class="text-[13px] text-[#bbb]">증권 <span title="i">ⓘ</span></span>
    </div>
    <div class="flex items-end my-2">
      <span id ="balance" class="text-[28px] font-bold text-[#222] mr-2 bg-white">0원</span>
      <span class="text-[17px] text-[#b2b2b2] ml-1">&#8250;</span>
    </div>
    <div class="flex items-center gap-3 mt-2">
      <button class="bg-[#1887fc] hover:bg-[#309eff] text-white text-[14px] rounded-[12px] px-4 py-1 font-medium shadow transition">2원 이자 받기</button>
      <div class="flex-1"></div>
      <button id ="chargeBtn" class="bg-[#ececec] hover:bg-[#f8fafd] text-[#444] text-[15px] rounded-[8px] px-4 py-1 font-medium transition">충전</button>
      <button id ="sendBtn" class="bg-[#ffe812] hover:bg-[#fff275] text-[#222] text-[15px] rounded-[8px] px-4 py-1 font-bold transition">송금</button>
    </div>
  </div>
  <!-- 충전 모달 -->
  <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-30 z-50 flex items-center justify-center">
    <div class="bg-white w-80 rounded-xl p-5 shadow-xl relative">
      <div class="text-lg font-bold mb-4">💳 얼마나 충전할까요?</div>
      <button onclick="closeModal()" class="absolute top-3 right-4 text-xl text-gray-500 hover:text-red-500">✖</button>
      <div class="space-y-2">
        <button class="quick-charge w-full bg-gray-100 hover:bg-gray-200 rounded py-2" data-amount="1000000">100만원</button>
        <button class="quick-charge w-full bg-gray-100 hover:bg-gray-200 rounded py-2" data-amount="500000">50만원</button>
        <button class="quick-charge w-full bg-gray-100 hover:bg-gray-200 rounded py-2" data-amount="300000">30만원</button>
        <button class="quick-charge w-full bg-gray-100 hover:bg-gray-200 rounded py-2" data-amount="200000">20만원</button>
        <button class="quick-charge w-full bg-gray-100 hover:bg-gray-200 rounded py-2" data-amount="100000">10만원</button>
        <button id="customCharge" class="w-full bg-blue-100 hover:bg-blue-200 rounded py-2 mt-2 font-semibold">직접 입력하기</button>
      </div>
    </div>
  </div>

  <!-- 송금 모달 -->
  <div id="sendModal" class="hidden fixed inset-0 bg-black bg-opacity-30 z-50 flex items-center justify-center">
    <div class="bg-white w-80 rounded-xl p-5 shadow-xl relative">
      <div class="text-lg font-bold mb-4">🏦 어디로 보낼까요?</div>
      <button onclick="closeSendModal()" class="absolute top-3 right-4 text-xl text-gray-500 hover:text-red-500">✖</button>
      <div class="text-sm text-gray-500 mb-2">최근 보낸 계좌</div>
      <div class="border border-gray-200 rounded-md p-3 mb-4">
        <b>김도훈</b><br>
        국민 93930200979743
      </div>
      <button id="accountInputBtn" class="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-2 rounded">
        계좌번호 입력
      </button>
    </div>
  </div>


  <!-- 배너/공지 -->
  <div class="bg-white rounded-xl shadow mx-3 mt-4 p-4 flex justify-between items-center">
    <div>
      <div class="text-[16px] font-semibold text-[#232323] mb-1">유심 없이 바로 개통하는 법</div>
      <button class="text-[#1877f2] text-[15px] font-bold underline px-2 py-1 rounded transition hover:bg-[#f4f8fe] hover:shadow-sm">확인하기</button>
    </div>
    <div class="w-11 h-11 bg-[#f1f3fa] rounded-[9px] flex items-center justify-center text-[30px]">📱</div>
  </div>

  <!-- 주요 서비스 그리드 -->
  <div class="bg-white rounded-[15px] shadow mx-3 mt-4 py-5 px-3 grid grid-cols-4 gap-x-1 gap-y-2">
    <button class="flex flex-col items-center text-[13px] text-[#555] rounded-[12px] py-2 hover:bg-[#f7fafc] hover:shadow transition">
      <div class="w-8 h-8 bg-[#f6f8fa] rounded-[10px] flex items-center justify-center text-[18px] text-[#1887fc] mb-1">&#128179;</div>
      결제
    </button>
    <button class="flex flex-col items-center text-[13px] text-[#555] rounded-[12px] py-2 hover:bg-[#f7fafc] hover:shadow transition relative">
      <div class="w-8 h-8 bg-[#ffe812] rounded-[10px] flex items-center justify-center text-[18px] text-[#222] mb-1">&#128176;</div>
      <span class="absolute top-0 right-4 bg-[#ffe812] text-[#181600] text-[10px] rounded px-1.5 font-bold">pay</span>
      손해보험
    </button>
    <button class="flex flex-col items-center text-[13px] text-[#555] rounded-[12px] py-2 hover:bg-[#f7fafc] hover:shadow transition">
      <div class="w-8 h-8 bg-[#f6f8fa] rounded-[10px] flex items-center justify-center text-[18px] text-[#1887fc] mb-1">&#128179;</div>
      카드만들기
    </button>
    <button class="flex flex-col items-center text-[13px] text-[#555] rounded-[12px] py-2 hover:bg-[#f7fafc] hover:shadow transition">
      <div class="w-8 h-8 bg-[#f6f8fa] rounded-[10px] flex items-center justify-center text-[18px] text-[#1887fc] mb-1">&#128181;</div>
      대출비교
    </button>
    <button class="flex flex-col items-center text-[13px] text-[#555] rounded-[12px] py-2 hover:bg-[#f7fafc] hover:shadow transition">
      <div class="w-8 h-8 bg-[#f6f8fa] rounded-[10px] flex items-center justify-center text-[18px] text-[#1887fc] mb-1">&#128200;</div>
      신용관리
    </button>
    <button class="flex flex-col items-center text-[13px] text-[#555] rounded-[12px] py-2 hover:bg-[#f7fafc] hover:shadow transition">
      <div class="w-8 h-8 bg-[#f6f8fa] rounded-[10px] flex items-center justify-center text-[18px] text-[#1887fc] mb-1">&#128138;</div>
      보험진단
    </button>
    <button class="flex flex-col items-center text-[13px] text-[#555] rounded-[12px] py-2 hover:bg-[#f7fafc] hover:shadow transition">
      <div class="w-8 h-8 bg-[#f6f8fa] rounded-[10px] flex items-center justify-center text-[18px] text-[#1887fc] mb-1">&#128241;</div>
      통신비할인
    </button>
    <button class="flex flex-col items-center text-[13px] text-[#555] rounded-[12px] py-2 hover:bg-[#f7fafc] hover:shadow transition">
      <div class="w-8 h-8 bg-[#f6f8fa] rounded-[10px] flex items-center justify-center text-[18px] text-[#1887fc] mb-1">&#8250;</div>
      더보기
    </button>
  </div>

  <!-- 광고/홍보 박스 -->
  <div class="bg-[#f4f7fb] rounded-[14px] mx-3 mt-4 px-4 py-3 flex justify-between items-center">
    <div class="flex flex-col">
      <span class="text-[14px] font-medium text-[#444] leading-tight">AIA 건강+암보험(갱신형)<br>암 보험료 얼마일까?</span>
      <span class="text-[12px] text-[#999] mt-1">생명보험협회 심의필 제 2025-01614호<br>(2025-03-18~2026-03-17)</span>
    </div>
    <span class="text-[#ef4b4b] font-bold text-[15px] ml-4">AIA생명</span>
  </div>

  <!-- 통합내역 -->
  <div class="mx-3 mt-4 mb-28">
    <div class="text-[15px] text-[#888] font-semibold mb-2">통합내역</div>
    <div class="bg-white rounded-[14px] shadow p-4 flex items-center mb-2">
      <div class="w-[39px] h-[39px] rounded-full bg-[#e3e3e3] overflow-hidden flex items-center justify-center mr-4">
        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="프로필" class="w-full h-full object-cover"/>
      </div>
      <div class="flex-1 flex flex-col gap-0.5">
        <span class="text-[14px] font-medium text-[#222]">홍길동</span>
        <span class="text-[12px] text-[#bbb]">05.16. · 3시간 전</span>
      </div>
      <div class="text-right min-w-[90px]">
        <span class="text-[15px] font-bold text-[#191919]">+100,000원</span><br>
        <span class="text-[12px] text-[#1887fc]">송금</span>
      </div>
    </div>
    <!-- 추가 내역 복붙 가능 -->
  </div>

  <!-- 하단 네비게이션 -->
  <div class="fixed left-0 right-0 bottom-0 max-w-[440px] w-full mx-auto bg-white border-t border-[#f3f3f3] flex justify-around py-2 z-20">
    <button class="flex flex-col items-center text-[12px] font-medium text-[#191919]">
      <span class="text-[22px] mb-0.5">&#8962;</span>
      홈
    </button>
    <button class="flex flex-col items-center text-[12px] font-medium text-[#bbb] relative">
      <span class="text-[22px] mb-0.5">🎁<span class="absolute top-0 right-0 bg-[#ff3636] text-white text-[9px] rounded-full px-1 ml-1 -mt-2">•</span></span>
      혜택
    </button>
    <button class="flex flex-col items-center text-[12px] font-medium text-[#bbb]">
      <span class="text-[22px] mb-0.5">&#128179;</span>
      결제
    </button>
    <button class="flex flex-col items-center text-[12px] font-medium text-[#bbb]">
      <span class="text-[22px] mb-0.5">&#128176;</span>
      자산
    </button>
    <button class="flex flex-col items-center text-[12px] font-medium text-[#bbb]">
      <span class="text-[22px] mb-0.5">&#128200;</span>
      증권
    </button>
  </div>

  <!-- 오른쪽 아래 음성버튼 -->
  <button class="fixed right-6 bottom-24 z-30 w-14 h-14 bg-[#fee500] hover:bg-[#ffe812] rounded-full shadow-lg flex items-center justify-center border-none transition text-[29px]" id="voice-btn" title="음성 질문">
    <span class="text-[#191919]">&#127908;</span>
  </button>
    <script>
      let balance = 0;

    function updateBalance() {
      document.getElementById('balance').textContent = balance.toLocaleString() + "원";
    }

    // 충전 모달
    document.getElementById('chargeBtn').addEventListener('click', () => {
      document.getElementById('modal').classList.remove('hidden');
    });

    function closeModal() {
      document.getElementById('modal').classList.add('hidden');
    }

    document.querySelectorAll('.quick-charge').forEach(btn => {
      btn.addEventListener('click', function () {
        const amount = parseInt(this.getAttribute('data-amount'));
        balance += amount;
        updateBalance();
        alert(amount.toLocaleString() + "원이 충전되었습니다.");
        closeModal();
      });
    });

    document.getElementById('customCharge').addEventListener('click', () => {
      const input = prompt("충전할 금액을 직접 입력하세요:");
      const amount = parseInt(input);
      if (!isNaN(amount) && amount > 0) {
        balance += amount;
        updateBalance();
        alert(amount + "원이 충전되었습니다.");
        closeModal();
      } else {
        alert("올바른 금액을 입력해주세요.");
      }
    });

    // 송금 모달
    document.getElementById('sendBtn').addEventListener('click', () => {
      document.getElementById('sendModal').classList.remove('hidden');
    });

    function closeSendModal() {
      document.getElementById('sendModal').classList.add('hidden');
    }

    document.getElementById('accountInputBtn').addEventListener('click', () => {
      const account = prompt("계좌번호를 입력하세요:");
      if (!account) return alert("계좌번호를 입력해야 합니다.");

      const amount = prompt("송금할 금액을 입력하세요:");
      const intAmount = parseInt(amount);
      if (isNaN(intAmount) || intAmount <= 0) return alert("올바른 금액을 입력해주세요.");
      if (intAmount > balance) return alert("잔액이 부족합니다.");

      balance -= intAmount;
      updateBalance();
      alert(account + " 계좌로 " + intAmount.toLocaleString() + "원을 송금했습니다.");
      closeSendModal();
    });

    updateBalance();    
        // 1. 하단 네비게이션/서비스 버튼 클릭 시 이동
        document.getElementById('nav-home').onclick = () => location.href = 'home.html';
        document.getElementById('nav-benefit').onclick = () => location.href = 'benefit.html';
        document.getElementById('nav-pay').onclick = () => location.href = 'pay.html';
        document.getElementById('nav-money').onclick = () => location.href = 'money.html';
        document.getElementById('nav-paper').onclick = () => location.href = 'paper.html';

        // 주요 서비스 버튼 연결 (service-btn 순서: 결제/손해보험/카드만들기/대출비교/신용관리/보험진단/통신비할인/더보기)
        document.querySelectorAll('.service-btn').forEach((btn, idx) => {
            btn.onclick = () => {
                switch (idx) {
                    case 0: location.href = 'pay.html'; break;      // 결제
                    case 1: location.href = 'money.html'; break;    // 손해보험→자산
                    case 2: location.href = 'benefit.html'; break;  // 카드만들기→혜택
                    case 3: location.href = 'money.html'; break;    // 대출비교→자산
                    case 4: location.href = 'money.html'; break;    // 신용관리→자산
                    case 5: location.href = 'money.html'; break;    // 보험진단→자산
                    case 6: location.href = 'money.html'; break;    // 통신비할인→자산
                    case 7: location.href = 'benefit.html'; break;  // 더보기→혜택
                }
            };
        });

        // 2. 음성 명령 → 각 페이지 이동 or GPT TTS
        const pageMap = [
            { keys: ["홈"], file: "home.html" },
            { keys: ["혜택", "benefit"], file: "benefit.html" },
            { keys: ["결제", "pay", "결제창"], file: "pay.html" },
            { keys: ["머니", "자산", "money"], file: "money.html" },
            { keys: ["증권", "페이퍼", "paper"], file: "paper.html" }
        ];

        let isRecording = false;
        let recognition = null;
        let transcriptAll = '';

        window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const voiceBtn = document.getElementById('voice-btn');
        if (!window.SpeechRecognition) {
            alert('이 브라우저는 음성 인식을 지원하지 않습니다.');
            voiceBtn.disabled = true;
        } else {
            recognition = new window.SpeechRecognition();
            recognition.lang = 'ko-KR';
            recognition.interimResults = false;
            recognition.continuous = false;

            recognition.onstart = () => {
                transcriptAll = '';
                voiceBtn.innerHTML = '<span class="voice-icon">⏹️</span>';
            };
            recognition.onresult = (event) => {
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    transcriptAll += event.results[i][0].transcript;
                }
            };
            recognition.onerror = (event) => {
                isRecording = false;
                voiceBtn.innerHTML = '<span class="voice-icon">&#127908;</span>';
            };
            recognition.onend = () => {
                isRecording = false;
                voiceBtn.innerHTML = '<span class="voice-icon">&#127908;</span>';
                const userSpeech = transcriptAll.trim();
                if (!userSpeech) return;

                // ★ 실제 인식된 문장 콘솔로 확인 (디버깅용, 배포 시 제거)
                console.log("음성 인식:", userSpeech);

                // 페이지 이동 키워드만 들어가도 바로 이동 (조건 넓게)
                let found = false;
                for (let page of pageMap) {
                    for (let key of page.keys) {
                        if (userSpeech.includes(key)) {
                            location.href = page.file;
                            found = true;
                            break;
                        }
                    }
                    if (found) break;
                }
                // 못찾으면 GPT에게 질문 + TTS
                if (!found) {
                    fetch('http://localhost:3000/askgpt', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question: userSpeech })
                    })
                        .then(r => r.json())
                        .then(data => {
                            let answer = (data.answer || '응답이 없습니다.');
                            const tts = new SpeechSynthesisUtterance(answer);
                            tts.lang = 'ko-KR';
                            window.speechSynthesis.speak(tts);
                        })
                        .catch(err => {
                            // 실패시에도 UI 변화 없음
                        });
                }
            };

            voiceBtn.onclick = function () {
                // 🔥 음성 합성(TTS) 중이면 즉시 중단
                window.speechSynthesis.cancel();

                if (!isRecording) {
                    recognition.start();
                    isRecording = true;
                    voiceBtn.innerHTML = '<span class="voice-icon">⏹️</span>';
                } else {
                    recognition.stop();
                }
            };
        }
    </script>

</body>

</html>